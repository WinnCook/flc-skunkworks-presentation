<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.5, minimum-scale=0.3, maximum-scale=3.0, user-scalable=yes">
    <title>FLC Skunk Works | Command Center</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- FullCalendar -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>

    <!-- html2pdf for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'flc-blue': '#003366',
                        'flc-gold': '#C4A000',
                        'flc-light': '#4A90D9',
                    },
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #C4A000; border-radius: 3px; }

        /* Animated counter */
        @keyframes countUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .counter-animate { animation: countUp 0.5s ease-out; }

        /* Glow effect */
        .glow-gold { box-shadow: 0 0 20px rgba(196, 160, 0, 0.3); }

        /* Presentation mode styles */
        .presentation-mode .edit-control { display: none !important; }
        .presentation-mode .view-only { display: block !important; }

        /* Status colors */
        .status-planning { background: rgba(234, 179, 8, 0.2); color: #eab308; }
        .status-active { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .status-blocked { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .status-complete { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }

        /* Log category colors */
        .log-decision { border-left-color: #8b5cf6; }
        .log-progress { border-left-color: #22c55e; }
        .log-blocker { border-left-color: #ef4444; }
        .log-win { border-left-color: #eab308; }
        .log-note { border-left-color: #6b7280; }

        /* Print styles */
        @media print {
            .no-print { display: none !important; }
            .print-break { page-break-before: always; }
        }

        /* FullCalendar overrides */
        .fc { background: transparent; }
        .fc-theme-standard td, .fc-theme-standard th { border-color: #374151; }
        .fc-theme-standard .fc-scrollgrid { border-color: #374151; }
        .fc-col-header-cell-cushion, .fc-daygrid-day-number { color: #9ca3af; }
        .fc-day-today { background: rgba(196, 160, 0, 0.1) !important; }

        /* Collapsible project sections */
        .project-section { border-radius: 8px; overflow: hidden; margin-bottom: 8px; }
        .project-header { cursor: pointer; transition: background-color 0.2s; }
        .project-header:hover { background-color: rgba(255,255,255,0.05); }
        .project-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, opacity 0.2s ease-out;
            opacity: 0;
        }
        .project-details.expanded {
            max-height: 500px;
            opacity: 1;
            transition: max-height 0.4s ease-in, opacity 0.3s ease-in;
        }
        .chevron-icon {
            transition: transform 0.3s ease;
            transform: rotate(0deg);
        }
        .chevron-icon.expanded {
            transform: rotate(180deg);
        }

        /* ROI Table styling */
        .roi-table { border-collapse: separate; border-spacing: 0; }
        .roi-table th { position: sticky; top: 0; background: #1f2937; z-index: 10; }
        .roi-positive { color: #22c55e; }
        .roi-negative { color: #ef4444; }
        .roi-neutral { color: #9ca3af; }

        /* Expandable Edit Panel for Initiatives */
        .edit-panel {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .edit-panel.expanded {
            max-height: 400px;
            transition: max-height 0.4s ease-in;
        }
        .initiative-card:hover {
            box-shadow: 0 0 20px rgba(196, 160, 0, 0.15);
        }

        /* Prevent horizontal overflow on mobile */
        html, body {
            overflow-x: hidden;
            max-width: 100vw;
        }

        /* Scenario Toggle Styles */
        .scenario-btn {
            transition: all 0.2s ease;
        }
        .scenario-btn.active-conservative {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }
        .scenario-btn.active-moderate {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
        }
        .scenario-btn.active-optimistic {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3);
        }

        /* Mobile Sidebar Styles - JavaScript controlled via .is-mobile class on body */

        /* Default: desktop - hamburger hidden, sidebar visible */
        #hamburgerBtn {
            display: none;
        }
        #sidebar {
            position: fixed;
            left: 0;
            top: 64px;
            bottom: 0;
            width: 256px;
            transform: translateX(0);
        }
        .sidebar-overlay {
            display: none;
        }

        /* Mobile: when body has .is-mobile class (set by JavaScript) */
        body.is-mobile #hamburgerBtn {
            display: flex !important;
        }
        body.is-mobile #sidebar {
            position: fixed;
            left: 0;
            top: 64px;
            bottom: 0;
            width: 256px;
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
            z-index: 40;
            background: rgba(31, 41, 55, 0.98);
        }
        body.is-mobile #sidebar.open {
            transform: translateX(0);
        }
        body.is-mobile .sidebar-overlay {
            display: block;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 35;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        body.is-mobile .sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        body.is-mobile .main-content {
            margin-left: 0 !important;
        }
        body.is-mobile .footer-bar {
            left: 0 !important;
        }
        body.is-mobile .nav-btn-text {
            display: none;
        }
        body.is-mobile .main-content {
            padding: 1rem !important;
        }

        /* Desktop nav buttons - visible by default, hidden on mobile */
        #desktopNavBtns {
            display: flex;
        }
        body.is-mobile #desktopNavBtns {
            display: none !important;
        }

        /* Right nav hamburger - hidden by default, shown on mobile */
        #navHamburgerBtn {
            display: none;
        }
        body.is-mobile #navHamburgerBtn {
            display: flex !important;
        }
    </style>
</head>

<body class="bg-gray-900 text-white font-sans min-h-screen">
    <!-- Top Navigation -->
    <nav class="fixed top-0 left-0 right-0 z-50 bg-gray-900/95 backdrop-blur-sm border-b border-gray-800 h-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-full">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-3">
                    <!-- Dashboard Sidebar Hamburger (mobile only) -->
                    <button id="hamburgerBtn" onclick="toggleSidebar()"
                            class="hamburger-btn items-center justify-center w-10 h-10 rounded-lg bg-gray-800 hover:bg-gray-700 border border-gray-700 transition">
                        <svg id="hamburgerIcon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                        </svg>
                        <svg id="closeIcon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                    <a href="index.html" class="flex items-center space-x-3 hover:opacity-80 transition">
                        <div class="w-10 h-10 bg-flc-gold rounded-lg flex items-center justify-center font-bold text-flc-blue">
                            FLC
                        </div>
                        <span class="font-semibold text-lg">Skunk Works</span>
                    </a>
                </div>
                <!-- Desktop buttons -->
                <div id="desktopNavBtns" class="flex items-center space-x-4">
                    <a href="index.html#ask" class="bg-flc-gold text-flc-blue px-4 py-2 rounded-lg font-semibold hover:bg-yellow-500 transition">The Ask</a>
                    <a href="dashboard.html" class="px-4 py-2 rounded-lg font-semibold bg-gradient-to-r from-purple-600 to-cyan-600 text-white hover:from-purple-500 hover:to-cyan-500 transition flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"></path>
                        </svg>
                        Dashboard
                    </a>
                    <a href="origin-story.html" class="px-4 py-2 rounded-lg font-semibold bg-gradient-to-r from-amber-600 to-orange-600 text-white hover:from-amber-500 hover:to-orange-500 transition flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                        </svg>
                        Origins
                    </a>
                    <a href="partnership-path.html" class="px-4 py-2 rounded-lg font-semibold bg-gradient-to-r from-emerald-600 to-teal-600 text-white hover:from-emerald-500 hover:to-teal-500 transition flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                        Partnership
                    </a>
                    <a href="https://winncook.github.io/concept-demo-flc-website-prototype/index.html" target="_blank" class="px-4 py-2 rounded-lg font-semibold bg-gradient-to-r from-sky-500 to-indigo-600 text-white hover:from-sky-400 hover:to-indigo-500 transition flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                        Horizon (Concept)
                    </a>
                </div>
                <!-- Mobile hamburger button for nav menu -->
                <button id="navHamburgerBtn" onclick="document.getElementById('mobileMenuDashboard').classList.toggle('hidden')"
                        class="items-center justify-center w-10 h-10 rounded-lg bg-gray-800 hover:bg-gray-700 border border-gray-700 transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
        </div>
        <!-- Mobile menu dropdown -->
        <div id="mobileMenuDashboard" class="hidden md:hidden bg-gray-800/98 border-b border-gray-700">
            <div class="px-4 py-3 space-y-1">
                <a href="index.html#ask" onclick="document.getElementById('mobileMenuDashboard').classList.add('hidden')" class="flex items-center gap-3 bg-gray-700/80 hover:bg-gray-600/80 text-white px-4 py-2.5 rounded-lg font-medium transition">
                    <svg class="w-5 h-5 text-flc-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"></path>
                    </svg>
                    <span>The Ask</span>
                </a>
                <a href="dashboard.html" class="flex items-center gap-3 bg-gray-700/80 hover:bg-gray-600/80 text-white px-4 py-2.5 rounded-lg font-medium transition">
                    <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"></path>
                    </svg>
                    <span>Dashboard</span>
                </a>
                <a href="origin-story.html" class="flex items-center gap-3 bg-gray-700/80 hover:bg-gray-600/80 text-white px-4 py-2.5 rounded-lg font-medium transition">
                    <svg class="w-5 h-5 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                    </svg>
                    <span>Origins</span>
                </a>
                <a href="partnership-path.html" class="flex items-center gap-3 bg-gray-700/80 hover:bg-gray-600/80 text-white px-4 py-2.5 rounded-lg font-medium transition">
                    <svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                    </svg>
                    <span>Partnership</span>
                </a>
                <a href="https://winncook.github.io/concept-demo-flc-website-prototype/index.html" target="_blank" class="flex items-center gap-3 bg-gray-700/80 hover:bg-gray-600/80 text-white px-4 py-2.5 rounded-lg font-medium transition">
                    <svg class="w-5 h-5 text-sky-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                    </svg>
                    <span>Horizon (Concept)</span>
                </a>
            </div>
        </div>
    </nav>

    <!-- Sidebar Overlay (mobile only) -->
    <div id="sidebarOverlay" class="sidebar-overlay" onclick="closeSidebar()"></div>

    <!-- Main Layout -->
    <div class="flex pt-16">
        <!-- Sidebar -->
        <aside id="sidebar" class="bg-gray-800/50 border-r border-gray-700 p-4 no-print">
            <nav class="space-y-2">
                <button onclick="showView('dashboard')" data-view="dashboard"
                        class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left hover:bg-gray-700 transition">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>
                    </svg>
                    Dashboard
                </button>

                <button onclick="showView('initiatives')" data-view="initiatives"
                        class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left hover:bg-gray-700 transition">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                    </svg>
                    Initiatives
                </button>

                <button onclick="showView('calendar')" data-view="calendar"
                        class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left hover:bg-gray-700 transition">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                    Calendar
                </button>

                <button onclick="showView('log')" data-view="log"
                        class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left hover:bg-gray-700 transition">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    Captain's Log
                </button>

                <button onclick="showView('stakeholders')" data-view="stakeholders"
                        class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left hover:bg-gray-700 transition">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/>
                    </svg>
                    Stakeholders
                </button>
            </nav>

            <!-- Quick Log Entry -->
            <div class="mt-8 edit-control">
                <h3 class="text-sm font-semibold text-gray-400 mb-3">Quick Log Entry</h3>
                <textarea id="quickLog" rows="3" placeholder="Add a quick note..."
                          class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-sm resize-none focus:border-flc-gold focus:outline-none"></textarea>
                <button onclick="addQuickLog()" class="w-full mt-2 py-2 bg-flc-gold text-flc-blue rounded-lg font-semibold text-sm hover:bg-yellow-500 transition">
                    Add Entry
                </button>
            </div>

            <!-- Keyboard Shortcuts -->
            <div class="mt-8 text-xs text-gray-500">
                <p class="font-semibold mb-2">Shortcuts</p>
                <p><kbd class="px-1 bg-gray-700 rounded">P</kbd> Presentation</p>
                <p><kbd class="px-1 bg-gray-700 rounded">D</kbd> Dashboard</p>
                <p><kbd class="px-1 bg-gray-700 rounded">I</kbd> Initiatives</p>
                <p><kbd class="px-1 bg-gray-700 rounded">N</kbd> New Log</p>
            </div>

            <!-- Mobile Navigation Links (shown on mobile only) -->
            <div id="mobileNavLinks" class="mt-6 pt-6 border-t border-gray-700" style="display: none;">
                <p class="text-xs font-semibold text-gray-400 mb-3 uppercase tracking-wider">Navigate</p>
                <div class="space-y-1">
                    <a href="index.html#ask" onclick="closeSidebar()" class="flex items-center gap-3 px-4 py-2.5 rounded-lg hover:bg-gray-700 transition">
                        <svg class="w-5 h-5 text-flc-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"></path>
                        </svg>
                        <span class="text-sm">The Ask</span>
                    </a>
                    <a href="index.html" onclick="closeSidebar()" class="flex items-center gap-3 px-4 py-2.5 rounded-lg hover:bg-gray-700 transition">
                        <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                        </svg>
                        <span class="text-sm">Main Pitch</span>
                    </a>
                    <a href="origin-story.html" onclick="closeSidebar()" class="flex items-center gap-3 px-4 py-2.5 rounded-lg hover:bg-gray-700 transition">
                        <svg class="w-5 h-5 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                        </svg>
                        <span class="text-sm">Origins</span>
                    </a>
                    <a href="partnership-path.html" onclick="closeSidebar()" class="flex items-center gap-3 px-4 py-2.5 rounded-lg hover:bg-gray-700 transition">
                        <svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                        <span class="text-sm">Partnership</span>
                    </a>
                    <a href="https://winncook.github.io/concept-demo-flc-website-prototype/index.html" target="_blank" onclick="closeSidebar()" class="flex items-center gap-3 px-4 py-2.5 rounded-lg hover:bg-gray-700 transition">
                        <svg class="w-5 h-5 text-sky-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                        <span class="text-sm">Horizon (Concept)</span>
                    </a>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content ml-0 md:ml-64 flex-1 p-4 sm:p-6 min-h-screen" id="mainContent">

            <!-- DASHBOARD VIEW -->
            <div id="view-dashboard" class="view">
                <!-- Value Cards - All values are ANNUAL (per year) -->
                <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3 sm:gap-4 mb-8">
                    <div class="bg-gradient-to-br from-green-900/50 to-green-800/30 rounded-xl p-5 border border-green-700/50">
                        <p class="text-green-400 text-sm font-medium mb-1">Annual Value</p>
                        <p class="text-3xl font-bold text-white">$<span id="totalValue" class="counter-animate">0</span></p>
                        <p class="text-green-400/60 text-xs mt-2">Per year (gross)</p>
                    </div>
                    <div class="bg-gradient-to-br from-blue-900/50 to-blue-800/30 rounded-xl p-5 border border-blue-700/50">
                        <p class="text-blue-400 text-sm font-medium mb-1">Cost Savings</p>
                        <p class="text-3xl font-bold text-white">$<span id="totalSavings" class="counter-animate">0</span></p>
                        <p class="text-blue-400/60 text-xs mt-2">Per year</p>
                    </div>
                    <div class="bg-gradient-to-br from-yellow-900/50 to-yellow-800/30 rounded-xl p-5 border border-yellow-700/50">
                        <p class="text-yellow-400 text-sm font-medium mb-1">Revenue Potential</p>
                        <p class="text-3xl font-bold text-white">$<span id="totalRevenue" class="counter-animate">0</span></p>
                        <p class="text-yellow-400/60 text-xs mt-2">Per year</p>
                    </div>
                    <div class="bg-gradient-to-br from-cyan-900/50 to-cyan-800/30 rounded-xl p-5 border border-cyan-700/50">
                        <p class="text-cyan-400 text-sm font-medium mb-1">Productivity Savings</p>
                        <p class="text-3xl font-bold text-white">$<span id="totalProductivity" class="counter-animate">0</span></p>
                        <p class="text-cyan-400/60 text-xs mt-2">Per year</p>
                    </div>
                    <div class="bg-gradient-to-br from-purple-900/50 to-purple-800/30 rounded-xl p-5 border border-purple-700/50">
                        <p class="text-purple-400 text-sm font-medium mb-1">Active Initiatives</p>
                        <p class="text-3xl font-bold text-white"><span id="activeCount" class="counter-animate">0</span></p>
                        <p class="text-purple-400/60 text-xs mt-2">In progress</p>
                    </div>
                </div>

                <!-- Initiatives Grid -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold">Initiative Status</h2>
                        <button onclick="showAddInitiativeModal()" class="edit-control px-4 py-2 bg-flc-gold text-flc-blue rounded-lg font-semibold text-sm hover:bg-yellow-500 transition">
                            + Add Initiative
                        </button>
                    </div>
                    <div id="initiativesGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Populated by JS -->
                    </div>
                </div>


                <!-- Scenario Toggle -->
                <div id="scenarioToggle" class="mb-6 bg-gray-800/50 rounded-xl p-4 border border-gray-700">
                    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                        <div class="flex items-center gap-3">
                            <svg class="w-5 h-5 text-flc-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                            </svg>
                            <span class="font-semibold text-gray-300">Projection Scenario</span>
                        </div>

                        <!-- 3-Node Toggle Switch -->
                        <div class="flex items-center gap-1 bg-gray-900 rounded-lg p-1 border border-gray-700">
                            <button onclick="setScenario('conservative')"
                                    id="btn-conservative"
                                    class="scenario-btn px-3 sm:px-4 py-2 rounded-md text-sm font-medium active-conservative">
                                Conservative
                            </button>
                            <button onclick="setScenario('moderate')"
                                    id="btn-moderate"
                                    class="scenario-btn px-3 sm:px-4 py-2 rounded-md text-sm font-medium text-gray-400 hover:text-white hover:bg-gray-700">
                                Moderate
                            </button>
                            <button onclick="setScenario('optimistic')"
                                    id="btn-optimistic"
                                    class="scenario-btn px-3 sm:px-4 py-2 rounded-md text-sm font-medium text-gray-400 hover:text-white hover:bg-gray-700">
                                Optimistic
                            </button>
                        </div>

                        <!-- Share link button -->
                        <button onclick="copyScenarioLink()"
                                class="flex items-center gap-2 px-3 py-2 rounded-lg text-sm text-gray-400 hover:text-white hover:bg-gray-700 transition"
                                title="Copy shareable link">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/>
                            </svg>
                            Share
                        </button>
                    </div>
                    <p id="scenarioDescription" class="mt-2 text-sm text-gray-500 italic">
                        Baseline projections with conservative estimates
                    </p>
                </div>

                <!-- 5-Year Financial Projection Table -->
                <div class="bg-gray-800 rounded-xl p-4 sm:p-6 border border-gray-700">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 mb-4">
                        <h3 class="font-bold text-lg flex items-center gap-2">
                            <svg class="w-5 h-5 text-flc-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                            </svg>
                            5-Year Financial Projection
                        </h3>
                        <div id="roiSummaryBadge" class="flex flex-wrap items-center gap-2 sm:gap-3">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                    <div id="multiYearTable" class="overflow-x-auto">
                        <!-- Generated by JS -->
                    </div>
                </div>
            </div>

            <!-- INITIATIVES VIEW -->
            <div id="view-initiatives" class="view hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Initiatives</h2>
                    <button onclick="showAddInitiativeModal()" class="edit-control px-4 py-2 bg-flc-gold text-flc-blue rounded-lg font-semibold hover:bg-yellow-500 transition">
                        + Add Initiative
                    </button>
                </div>
                <div id="initiativesList" class="space-y-4">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- CALENDAR VIEW -->
            <div id="view-calendar" class="view hidden">
                <h2 class="text-2xl font-bold mb-6">Project Timeline</h2>
                <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                    <div id="calendar"></div>
                </div>
            </div>

            <!-- CAPTAIN'S LOG VIEW -->
            <div id="view-log" class="view hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Captain's Log</h2>
                    <div class="flex gap-3">
                        <button onclick="exportLog()" class="px-4 py-2 bg-gray-700 rounded-lg text-sm hover:bg-gray-600 transition">
                            Export Markdown
                        </button>
                        <button onclick="showAddLogModal()" class="edit-control px-4 py-2 bg-flc-gold text-flc-blue rounded-lg font-semibold hover:bg-yellow-500 transition">
                            + New Entry
                        </button>
                    </div>
                </div>

                <!-- Filters -->
                <div class="flex gap-4 mb-6 edit-control">
                    <input type="text" id="logSearch" placeholder="Search logs..." oninput="filterLogs()"
                           class="flex-1 bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 focus:border-flc-gold focus:outline-none">
                    <select id="logCategoryFilter" onchange="filterLogs()"
                            class="bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 focus:border-flc-gold focus:outline-none">
                        <option value="">All Categories</option>
                        <option value="decision">Decisions</option>
                        <option value="progress">Progress</option>
                        <option value="blocker">Blockers</option>
                        <option value="win">Wins</option>
                        <option value="note">Notes</option>
                    </select>
                </div>

                <div id="logList" class="space-y-3">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- STAKEHOLDER IMPACT VIEW -->
            <div id="view-stakeholders" class="view hidden">
                <h2 class="text-2xl font-bold mb-6">Stakeholder Impact Matrix</h2>
                <div class="bg-gray-800 rounded-xl p-6 border border-gray-700 overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr>
                                <th class="text-left p-3 border-b border-gray-700">Initiative</th>
                                <th class="text-center p-3 border-b border-gray-700">VP</th>
                                <th class="text-center p-3 border-b border-gray-700">Exec Team</th>
                                <th class="text-center p-3 border-b border-gray-700">Faculty</th>
                                <th class="text-center p-3 border-b border-gray-700">Staff</th>
                                <th class="text-center p-3 border-b border-gray-700">Students</th>
                                <th class="text-center p-3 border-b border-gray-700">Board</th>
                            </tr>
                        </thead>
                        <tbody id="stakeholderMatrix">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
                <div class="mt-4 text-sm text-gray-400">
                    <span class="inline-flex items-center gap-1"><span class="w-4 h-4 bg-green-500 rounded"></span> High Impact</span>
                    <span class="inline-flex items-center gap-1 ml-4"><span class="w-4 h-4 bg-yellow-500 rounded"></span> Medium Impact</span>
                    <span class="inline-flex items-center gap-1 ml-4"><span class="w-4 h-4 bg-gray-500 rounded"></span> Low/Indirect</span>
                </div>
            </div>

        </main>
    </div>

    <!-- Value Footer Bar -->
    <footer class="footer-bar fixed bottom-0 left-0 md:left-64 right-0 h-12 bg-gray-800/95 backdrop-blur-sm border-t border-gray-700 flex items-center justify-center gap-4 sm:gap-8 text-xs sm:text-sm no-print">
        <span class="text-gray-400">Annual Value: <strong class="text-flc-gold">$<span id="footerValue">0</span>/yr</strong></span>
        <span class="text-gray-600">|</span>
        <span class="text-gray-400">Initiatives: <strong class="text-white"><span id="footerCount">0</span></strong></span>
        <span class="text-gray-600">|</span>
        <span class="text-gray-400">Annual ROI: <strong class="text-green-400"><span id="footerROI">0</span>%</strong></span>
    </footer>

    <!-- MODALS -->

    <!-- Initiative Modal -->
    <div id="initiativeModal" class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-800 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto m-4">
            <div class="p-6 border-b border-gray-700 flex justify-between items-center">
                <h3 id="modalTitle" class="text-xl font-bold">Add Initiative</h3>
                <button onclick="closeModal('initiativeModal')" class="text-gray-400 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <form id="initiativeForm" onsubmit="saveInitiative(event)" class="p-6 space-y-4">
                <input type="hidden" id="initId">

                <div class="grid grid-cols-2 gap-4">
                    <div class="col-span-2">
                        <label class="block text-sm text-gray-400 mb-1">Initiative Name</label>
                        <input type="text" id="initName" required
                               class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 focus:border-flc-gold focus:outline-none">
                    </div>

                    <div class="col-span-2">
                        <label class="block text-sm text-gray-400 mb-1">Description</label>
                        <textarea id="initDescription" rows="2"
                                  class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 focus:border-flc-gold focus:outline-none"></textarea>
                    </div>

                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Status</label>
                        <select id="initStatus"
                                class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 focus:border-flc-gold focus:outline-none">
                            <option value="planning">Planning</option>
                            <option value="active">Active</option>
                            <option value="blocked">Blocked</option>
                            <option value="complete">Complete</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Priority</label>
                        <select id="initPriority"
                                class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 focus:border-flc-gold focus:outline-none">
                            <option value="critical">Critical</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Start Date</label>
                        <input type="date" id="initStartDate"
                               class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 focus:border-flc-gold focus:outline-none">
                    </div>

                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Target Date</label>
                        <input type="date" id="initTargetDate"
                               class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 focus:border-flc-gold focus:outline-none">
                    </div>
                </div>

                <hr class="border-gray-700 my-4">
                <h4 class="font-semibold text-flc-gold">Value Tracking</h4>

                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Annual Savings ($)</label>
                        <input type="number" id="initSavings" value="0"
                               class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 focus:border-flc-gold focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Revenue Potential ($)</label>
                        <input type="number" id="initRevenue" value="0"
                               class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 focus:border-flc-gold focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Productivity Value ($)</label>
                        <input type="number" id="initProductivity" value="0"
                               class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 focus:border-flc-gold focus:outline-none">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Investment Required ($)</label>
                        <input type="number" id="initInvestment" value="0"
                               class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 focus:border-flc-gold focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Ongoing Cost ($/year)</label>
                        <input type="number" id="initOngoing" value="0"
                               class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 focus:border-flc-gold focus:outline-none">
                    </div>
                </div>

                <div class="mt-3">
                    <label class="flex items-center gap-3 cursor-pointer group">
                        <input type="checkbox" id="initRecurringY1"
                               class="w-5 h-5 rounded bg-gray-700 border-gray-600 text-flc-gold focus:ring-flc-gold focus:ring-offset-gray-800">
                        <span class="text-sm text-gray-300 group-hover:text-white transition">
                            Recurring costs begin Year 1
                            <span class="text-gray-500 text-xs block">When unchecked, ongoing costs start in Year 2</span>
                        </span>
                    </label>
                </div>

                <hr class="border-gray-700 my-4">
                <h4 class="font-semibold text-flc-gold">Value Propositions</h4>
                <p class="text-xs text-gray-500 mb-2">One bullet point per line - explains the rationale behind projected value</p>
                <textarea id="initValueProps" rows="4" placeholder="Enter value propositions (one per line)..."
                          class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 focus:border-flc-gold focus:outline-none text-sm"></textarea>

                <hr class="border-gray-700 my-4">
                <h4 class="font-semibold text-flc-gold">Stakeholder Impact</h4>
                <div class="grid grid-cols-3 gap-4 text-sm">
                    <label class="flex items-center gap-2">
                        <input type="checkbox" id="impact-vp" class="rounded bg-gray-700 border-gray-600">
                        <span>VP</span>
                    </label>
                    <label class="flex items-center gap-2">
                        <input type="checkbox" id="impact-exec" class="rounded bg-gray-700 border-gray-600">
                        <span>Exec Team</span>
                    </label>
                    <label class="flex items-center gap-2">
                        <input type="checkbox" id="impact-faculty" class="rounded bg-gray-700 border-gray-600">
                        <span>Faculty</span>
                    </label>
                    <label class="flex items-center gap-2">
                        <input type="checkbox" id="impact-staff" class="rounded bg-gray-700 border-gray-600">
                        <span>Staff</span>
                    </label>
                    <label class="flex items-center gap-2">
                        <input type="checkbox" id="impact-students" class="rounded bg-gray-700 border-gray-600">
                        <span>Students</span>
                    </label>
                    <label class="flex items-center gap-2">
                        <input type="checkbox" id="impact-board" class="rounded bg-gray-700 border-gray-600">
                        <span>Board</span>
                    </label>
                </div>

                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" onclick="closeModal('initiativeModal')" class="px-6 py-2 bg-gray-700 rounded-lg hover:bg-gray-600 transition">
                        Cancel
                    </button>
                    <button type="submit" class="px-6 py-2 bg-flc-gold text-flc-blue rounded-lg font-semibold hover:bg-yellow-500 transition">
                        Save Initiative
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Log Entry Modal -->
    <div id="logModal" class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-800 rounded-2xl w-full max-w-lg m-4">
            <div class="p-6 border-b border-gray-700 flex justify-between items-center">
                <h3 class="text-xl font-bold">New Log Entry</h3>
                <button onclick="closeModal('logModal')" class="text-gray-400 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <form onsubmit="saveLogEntry(event)" class="p-6 space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Category</label>
                    <select id="logCategory"
                            class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 focus:border-flc-gold focus:outline-none">
                        <option value="note">Note</option>
                        <option value="progress">Progress</option>
                        <option value="decision">Decision</option>
                        <option value="win">Win</option>
                        <option value="blocker">Blocker</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm text-gray-400 mb-1">Related Initiative (Optional)</label>
                    <select id="logInitiative"
                            class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 focus:border-flc-gold focus:outline-none">
                        <option value="">General (No specific initiative)</option>
                        <!-- Populated by JS -->
                    </select>
                </div>

                <div>
                    <label class="block text-sm text-gray-400 mb-1">Entry</label>
                    <textarea id="logContent" rows="4" required
                              class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 focus:border-flc-gold focus:outline-none"></textarea>
                </div>

                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" onclick="closeModal('logModal')" class="px-6 py-2 bg-gray-700 rounded-lg hover:bg-gray-600 transition">
                        Cancel
                    </button>
                    <button type="submit" class="px-6 py-2 bg-flc-gold text-flc-blue rounded-lg font-semibold hover:bg-yellow-500 transition">
                        Save Entry
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-800 rounded-2xl p-8 w-full max-w-md border border-gray-700">
            <h3 class="text-xl font-bold mb-4 text-red-400"> Delete Initiative</h3>
            <p class="text-gray-300 mb-2">Are you sure you want to delete this initiative?</p>
            <p id="deleteInitName" class="font-semibold text-white mb-4"></p>
            <p class="text-gray-400 text-sm mb-6">This initiative will be archived and can be recovered if needed.</p>
            <input type="hidden" id="deleteInitId" value="">
            <div class="flex justify-end gap-3">
                <button onclick="closeModal('deleteModal')" class="px-6 py-2 bg-gray-700 rounded-lg hover:bg-gray-600 transition">
                    Cancel
                </button>
                <button onclick="confirmDelete()" class="px-6 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition">
                    Delete
                </button>
            </div>
        </div>
    </div>

    <script>
        // ================== DATA MANAGEMENT ==================

        // Data version - increment when DEFAULT_DATA structure changes to force refresh
        const DATA_VERSION = 17; // v17: Session 19 - Fixed mobile sidebar properly with ID selectors

        // Scenario preset values (absolute values for each initiative)
        const SCENARIO_VALUES = {
            conservative: {
                'event-management': { savings: 4000, revenue: 0, productivity: 0 },
                'ai-meeting-assistant': { savings: 2500, revenue: 0, productivity: 0 },
                'enrollment-forecasting': { savings: 0, revenue: 0, productivity: 2800 }
            },
            moderate: {
                'event-management': { savings: 5000, revenue: 2000, productivity: 1000 },
                'ai-meeting-assistant': { savings: 3500, revenue: 1000, productivity: 2000 },
                'enrollment-forecasting': { savings: 1000, revenue: 2000, productivity: 4000 }
            },
            optimistic: {
                'event-management': { savings: 6000, revenue: 4000, productivity: 2000 },
                'ai-meeting-assistant': { savings: 5000, revenue: 2000, productivity: 3000 },
                'enrollment-forecasting': { savings: 2000, revenue: 4000, productivity: 5000 }
            }
        };

        const SCENARIO_DESCRIPTIONS = {
            conservative: 'Baseline projections with conservative estimates',
            moderate: 'Realistic growth with modest revenue assumptions',
            optimistic: 'Best-case scenario with full adoption and market expansion'
        };

        let currentScenario = 'conservative';

        const DEFAULT_DATA = {
            archived: [],
            initiatives: [
                {
                    id: 'event-management',
                    name: 'Event Management App (Phase 1 Project)',
                    description: 'FLC-owned conference and event platform with full Whova functionality. Scalable, customizable, and licensable for revenue.',
                    status: 'planning',
                    priority: 'high',
                    startDate: '2026-01-15',
                    targetDate: '2026-04-01',
                    costs: { investment: 7500, ongoing: 1000 },
                    recurringStartsY1: false,
                    value: { savings: 4000, revenue: 0, productivity: 0 },
                    stakeholders: ['vp', 'staff'],
                    valueProps: [
                        'Full Whova functionality - owned by FLC',
                        'Scalable for any event size',
                        'Licensable to community partners for revenue',
                        'Full institutional control over data and features'
                    ],
                    color: '#3b82f6',
                    costRange: '$7,500'
                },
                {
                    id: 'ai-meeting-assistant',
                    name: 'AI Meeting Assistant (Phase 1 Project)',
                    description: 'Joins meetings on your behalf, capturing transcripts and action items. Strengthens regulatory compliance, enhances internal communication, and enables PD attendance despite scheduling conflicts.',
                    status: 'planning',
                    priority: 'high',
                    startDate: '2026-02-01',
                    targetDate: '2026-05-01',
                    costs: { investment: 7500, ongoing: 1000 },
                    recurringStartsY1: false,
                    value: { savings: 2500, revenue: 0, productivity: 0 },
                    stakeholders: ['vp', 'exec', 'faculty', 'staff'],
                    valueProps: [
                        'Joins meetings and captures transcripts with action items',
                        'Strengthens regulatory compliance through documentation',
                        'Auto-drafts functional area updates and executive recaps',
                        'Enables PD attendance despite scheduling conflicts'
                    ],
                    color: '#22c55e',
                    costRange: '$7,500'
                },
                {
                    id: 'enrollment-forecasting',
                    name: 'Enrollment Forecasting v2 (Phase 1 Project)',
                    description: 'Executive web dashboard for enrollment scenario modeling. Builds on v1 proven <2% accuracy. Strategic decision support for leadership and finance. $7,500 project.',
                    status: 'planning',
                    priority: 'high',
                    startDate: '2026-02-15',
                    targetDate: '2026-06-30',
                    costs: { investment: 7500, ongoing: 2000 },
                    recurringStartsY1: false,
                    value: { savings: 0, revenue: 0, productivity: 2800 },
                    stakeholders: ['vp', 'exec', 'enrollment'],
                    valueProps: [
                        'Web app accessible by executive and finance teams',
                        'What-if scenario analysis for strategic enrollment planning',
                        'Built on v1 foundation with proven <2% accuracy',
                        'Admissions pipeline data integration for real-time insights'
                    ],
                    color: '#8b5cf6',
                    costRange: '$7,500'
                }
            ],
            captainsLog: [
                {
                    id: 'log-001',
                    timestamp: '2025-12-15T10:00:00',
                    category: 'progress',
                    initiativeId: null,
                    content: 'Initialized FLC Skunk Works program - created charter, folder structure, and governance documents.'
                },
                {
                    id: 'log-002',
                    timestamp: '2025-12-15T11:30:00',
                    category: 'decision',
                    initiativeId: null,
                    content: 'Identified three high-value initiatives: Whova replacement, Otter AI replacement, and VP presentation.'
                },
                {
                    id: 'log-003',
                    timestamp: '2025-12-15T14:00:00',
                    category: 'win',
                    initiativeId: 'vp-presentation',
                    content: 'Built interactive HTML showcase with ROI calculator and animated value counters.'
                },
                {
                    id: 'log-004',
                    timestamp: '2025-12-15T16:00:00',
                    category: 'progress',
                    initiativeId: 'vp-presentation',
                    content: 'Created Command Center dashboard with initiative tracking, captain\'s log, and presentation mode.'
                }
            ],
            settings: {
                presentationMode: false,
                expandedProjects: {} // Track which projects are expanded (all expanded by default)
            }
        };

        // Load or initialize data
        function loadData() {
            const storedVersion = localStorage.getItem('flc-skunkworks-version');
            const stored = localStorage.getItem('flc-skunkworks-data');

            // If version mismatch or no version, reset to defaults
            if (!storedVersion || parseInt(storedVersion) < DATA_VERSION) {
                console.log('Data version updated - resetting to new defaults');
                localStorage.setItem('flc-skunkworks-version', DATA_VERSION);
                saveData(DEFAULT_DATA);
                return DEFAULT_DATA;
            }

            if (stored) {
                return JSON.parse(stored);
            }
            saveData(DEFAULT_DATA);
            return DEFAULT_DATA;
        }

        function saveData(data) {
            localStorage.setItem('flc-skunkworks-data', JSON.stringify(data));
        }

        let appData = loadData();

        // ================== VIEW MANAGEMENT ==================

        let currentView = 'dashboard';
        let calendar = null;

        function showView(viewName) {
            currentView = viewName;
            document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
            document.getElementById(`view-${viewName}`).classList.remove('hidden');

            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-flc-gold/20', 'text-flc-gold');
                if (btn.dataset.view === viewName) {
                    btn.classList.add('bg-flc-gold/20', 'text-flc-gold');
                }
            });

            if (viewName === 'calendar' && !calendar) {
                initCalendar();
            }
            if (viewName === 'calendar' && calendar) {
                setTimeout(() => calendar.render(), 100);
            }

            renderView();
        }

        function renderView() {
            updateValueCards();
            renderInitiativesGrid();
            renderInitiativesList();
            renderLogList();
            renderStakeholderMatrix();
            generateMultiYearROI();
            updateFooter();
            populateLogInitiativeDropdown();
        }

        // ================== VALUE CALCULATIONS ==================

        function calculateTotals() {
            let totalSavings = 0;
            let totalRevenue = 0;
            let totalProductivity = 0;
            let totalInvestment = 0;
            let totalOngoing = 0;
            let activeCount = 0;

            appData.initiatives.forEach(init => {
                totalSavings += init.value.savings || 0;
                totalRevenue += init.value.revenue || 0;
                totalProductivity += init.value.productivity || 0;
                totalInvestment += init.costs?.investment || 0;
                totalOngoing += init.costs?.ongoing || 0;
                if (init.status === 'active' || init.status === 'planning') {
                    activeCount++;
                }
            });

            const totalValue = totalSavings + totalRevenue + totalProductivity;
            const totalCosts = totalInvestment + totalOngoing;
            // ROI = (Net Return / Investment) * 100
            // Net Return = Annual Value - Ongoing Costs
            // If no costs entered, show infinite/N/A
            const netAnnualReturn = totalValue - totalOngoing;
            const roi = totalCosts > 0 ? Math.round((netAnnualReturn / totalCosts) * 100) : (totalValue > 0 ? 999 : 0);

            return {
                totalValue,
                totalSavings,
                totalRevenue,
                totalProductivity,
                totalInvestment,
                totalOngoing,
                totalCosts,
                netAnnualReturn,
                activeCount,
                roi
            };
        }

        // Simple direct value update - no animation to avoid glitches
        function updateValueCards() {
            const totals = calculateTotals();
            document.getElementById('totalValue').textContent = totals.totalValue.toLocaleString();
            document.getElementById('totalSavings').textContent = totals.totalSavings.toLocaleString();
            document.getElementById('totalRevenue').textContent = totals.totalRevenue.toLocaleString();
            document.getElementById('totalProductivity').textContent = totals.totalProductivity.toLocaleString();
            document.getElementById('activeCount').textContent = totals.activeCount;
        }

        function updateFooter() {
            const totals = calculateTotals();
            document.getElementById('footerValue').textContent = totals.totalValue.toLocaleString();
            document.getElementById('footerCount').textContent = totals.activeCount;
            document.getElementById('footerROI').textContent = totals.roi >= 999 ? '' : totals.roi;
        }

        // ================== INITIATIVES ==================

        function renderInitiativesGrid() {
            const grid = document.getElementById('initiativesGrid');
            grid.innerHTML = appData.initiatives.map(init => {
                const totalValue = (init.value.savings + init.value.revenue + init.value.productivity);
                const isExpanded = appData.settings.allInitiativesExpanded || false;
                return `
                <div class="initiative-card bg-gray-800 rounded-xl border border-gray-700 hover:border-flc-gold/50 transition relative overflow-hidden"
                     id="card-${init.id}" style="border-left: 4px solid ${init.color}">
                    <!-- Clickable Header -->
                    <div onclick="toggleInitiativeCard('${init.id}')"
                         class="p-5 cursor-pointer hover:bg-gray-700/30 transition">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-bold text-lg">${init.name.split('(')[0].trim()}</h4>
                            <div class="flex items-center gap-2">
                                <span class="text-2xl font-bold text-green-400">$${totalValue.toLocaleString()}</span>
                                <svg class="w-5 h-5 text-gray-400 transform transition-transform ${isExpanded ? 'rotate-180' : ''}"
                                     id="chevron-${init.id}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                </svg>
                            </div>
                        </div>
                        <div class="flex gap-4 text-sm">
                            <span class="text-blue-400">Savings: $${init.value.savings.toLocaleString()}</span>
                            <span class="text-yellow-400">Revenue: $${init.value.revenue.toLocaleString()}</span>
                            <span class="text-cyan-400">Productivity: $${init.value.productivity.toLocaleString()}</span>
                        </div>
                    </div>

                    <!-- Expandable Edit Panel -->
                    <div id="panel-${init.id}" class="edit-panel ${isExpanded ? 'expanded' : ''} bg-gray-900/50 border-t border-gray-700">
                        <div class="p-5 space-y-4">
                            <!-- Value Inputs -->
                            <div class="grid grid-cols-3 gap-3">
                                <div>
                                    <label class="block text-xs text-blue-400 mb-1 font-medium">Cost Savings</label>
                                    <div class="relative">
                                        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">$</span>
                                        <input type="number" value="${init.value.savings}"
                                               onchange="updateInitiativeValue('${init.id}', 'savings', this.value)"
                                               class="w-full bg-gray-800 border border-gray-600 rounded-lg pl-7 pr-3 py-2 text-blue-400 font-semibold focus:border-blue-400 focus:outline-none">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs text-yellow-400 mb-1 font-medium">Revenue</label>
                                    <div class="relative">
                                        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">$</span>
                                        <input type="number" value="${init.value.revenue}"
                                               onchange="updateInitiativeValue('${init.id}', 'revenue', this.value)"
                                               class="w-full bg-gray-800 border border-gray-600 rounded-lg pl-7 pr-3 py-2 text-yellow-400 font-semibold focus:border-yellow-400 focus:outline-none">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs text-cyan-400 mb-1 font-medium">Productivity</label>
                                    <div class="relative">
                                        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">$</span>
                                        <input type="number" value="${init.value.productivity}"
                                               onchange="updateInitiativeValue('${init.id}', 'productivity', this.value)"
                                               class="w-full bg-gray-800 border border-gray-600 rounded-lg pl-7 pr-3 py-2 text-cyan-400 font-semibold focus:border-cyan-400 focus:outline-none">
                                    </div>
                                </div>
                            </div>
                            <!-- Cost Inputs -->
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs text-red-400 mb-1 font-medium">Investment (One-time)</label>
                                    <div class="relative">
                                        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">$</span>
                                        <input type="number" value="${init.costs?.investment || 0}"
                                               onchange="updateInitiativeCost('${init.id}', 'investment', this.value)"
                                               class="w-full bg-gray-800 border border-gray-600 rounded-lg pl-7 pr-3 py-2 text-red-400 font-semibold focus:border-red-400 focus:outline-none">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs text-red-400 mb-1 font-medium">Ongoing (Per Year)</label>
                                    <div class="relative">
                                        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">$</span>
                                        <input type="number" value="${init.costs?.ongoing || 0}"
                                               onchange="updateInitiativeCost('${init.id}', 'ongoing', this.value)"
                                               class="w-full bg-gray-800 border border-gray-600 rounded-lg pl-7 pr-3 py-2 text-red-400 font-semibold focus:border-red-400 focus:outline-none">
                                    </div>
                                </div>
                            </div>
                            <!-- Actions -->
                            <div class="flex justify-between items-center pt-2 border-t border-gray-700">
                                <button onclick="editInitiative('${init.id}')" class="text-sm text-flc-gold hover:text-yellow-400 flex items-center gap-1">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                                    </svg>
                                    Full Edit
                                </button>
                                <button onclick="event.stopPropagation(); showDeleteModal('${init.id}')" class="text-sm text-red-400 hover:text-red-300 flex items-center gap-1">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                    </svg>
                                    Delete
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `}).join('');
        }

        // Toggle ALL initiative cards expansion (clicking any card expands/collapses all)
        function toggleInitiativeCard(id) {
            // Use a single global expanded state for all cards
            if (!appData.settings.allInitiativesExpanded) {
                appData.settings.allInitiativesExpanded = false;
            }
            appData.settings.allInitiativesExpanded = !appData.settings.allInitiativesExpanded;
            saveData(appData);

            // Toggle all initiative cards
            appData.initiatives.forEach(init => {
                const panel = document.getElementById(`panel-${init.id}`);
                const chevron = document.getElementById(`chevron-${init.id}`);
                if (panel && chevron) {
                    if (appData.settings.allInitiativesExpanded) {
                        panel.classList.add('expanded');
                        chevron.classList.add('rotate-180');
                    } else {
                        panel.classList.remove('expanded');
                        chevron.classList.remove('rotate-180');
                    }
                }
            });
        }

        // Quick update initiative value
        function updateInitiativeValue(id, field, value) {
            const init = appData.initiatives.find(i => i.id === id);
            if (!init) return;
            init.value[field] = parseInt(value) || 0;
            saveData(appData);
            renderView();
        }

        // Quick update initiative cost
        function updateInitiativeCost(id, field, value) {
            const init = appData.initiatives.find(i => i.id === id);
            if (!init) return;
            if (!init.costs) init.costs = { investment: 0, ongoing: 0 };
            init.costs[field] = parseInt(value) || 0;
            saveData(appData);
            renderView();
        }

        function renderInitiativesList() {
            const list = document.getElementById('initiativesList');
            list.innerHTML = appData.initiatives.map(init => `
                <div class="bg-gray-800 rounded-xl p-6 border border-gray-700" style="border-left: 4px solid ${init.color}">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-xl font-bold">${init.name}</h3>
                            <p class="text-gray-400">${init.description}</p>
                        </div>
                        <div class="flex gap-2">
                            <span class="status-${init.status} px-3 py-1 rounded-full text-sm font-medium capitalize">${init.status}</span>
                            <button onclick="editInitiative('${init.id}')" class="edit-control p-2 bg-gray-700 rounded-lg hover:bg-gray-600" title="Edit">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                                </svg>
                            </button>
                            <button onclick="showDeleteModal('${init.id}')" class="edit-control p-2 bg-gray-700 rounded-lg hover:bg-red-600 transition" title="Delete">
                                <svg class="w-4 h-4 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="grid grid-cols-4 gap-4 text-center">
                        <div class="bg-gray-700/50 rounded-lg p-3">
                            <p class="text-2xl font-bold text-green-400">$${init.value.savings.toLocaleString()}</p>
                            <p class="text-xs text-gray-400">Savings</p>
                        </div>
                        <div class="bg-gray-700/50 rounded-lg p-3">
                            <p class="text-2xl font-bold text-yellow-400">$${init.value.revenue.toLocaleString()}</p>
                            <p class="text-xs text-gray-400">Revenue</p>
                        </div>
                        <div class="bg-gray-700/50 rounded-lg p-3">
                            <p class="text-2xl font-bold text-blue-400">$${init.value.productivity.toLocaleString()}</p>
                            <p class="text-xs text-gray-400">Productivity</p>
                        </div>
                        <div class="bg-gray-700/50 rounded-lg p-3">
                            <p class="text-2xl font-bold text-white">$${(init.value.savings + init.value.revenue + init.value.productivity).toLocaleString()}</p>
                            <p class="text-xs text-gray-400">Total Value</p>
                        </div>
                    </div>
                    <div class="mt-4 flex gap-4 text-sm text-gray-400">
                        <span>Start: ${init.startDate || 'TBD'}</span>
                        <span>Target: ${init.targetDate || 'TBD'}</span>
                        <span>Priority: <span class="capitalize">${init.priority}</span></span>
                    </div>
                </div>
            `).join('');
        }

        function saveInitiative(event) {
            event.preventDefault();

            const id = document.getElementById('initId').value || `init-${Date.now()}`;
            const stakeholders = [];
            ['vp', 'exec', 'faculty', 'staff', 'students', 'board'].forEach(s => {
                if (document.getElementById(`impact-${s}`).checked) stakeholders.push(s);
            });

            const initiative = {
                id,
                name: document.getElementById('initName').value,
                description: document.getElementById('initDescription').value,
                status: document.getElementById('initStatus').value,
                priority: document.getElementById('initPriority').value,
                startDate: document.getElementById('initStartDate').value,
                targetDate: document.getElementById('initTargetDate').value,
                costs: {
                    investment: parseInt(document.getElementById('initInvestment').value) || 0,
                    ongoing: parseInt(document.getElementById('initOngoing').value) || 0
                },
                recurringStartsY1: document.getElementById('initRecurringY1').checked,
                value: {
                    savings: parseInt(document.getElementById('initSavings').value) || 0,
                    revenue: parseInt(document.getElementById('initRevenue').value) || 0,
                    productivity: parseInt(document.getElementById('initProductivity').value) || 0
                },
                stakeholders,
                valueProps: document.getElementById('initValueProps').value
                    .split('\n')
                    .map(s => s.trim())
                    .filter(s => s.length > 0),
                color: ['#3b82f6', '#22c55e', '#eab308', '#ef4444', '#8b5cf6', '#06b6d4'][Math.floor(Math.random() * 6)]
            };

            const existingIndex = appData.initiatives.findIndex(i => i.id === id);
            if (existingIndex >= 0) {
                initiative.color = appData.initiatives[existingIndex].color;
                initiative.costRange = appData.initiatives[existingIndex].costRange;
                appData.initiatives[existingIndex] = initiative;
            } else {
                appData.initiatives.push(initiative);
            }

            saveData(appData);
            closeModal('initiativeModal');
            renderView();
            if (calendar) updateCalendar();
        }

        // Live update totals as user types in modal
        function setupLiveValueUpdates() {
            const valueFields = ['initSavings', 'initRevenue', 'initProductivity', 'initInvestment', 'initOngoing'];
            valueFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('input', updateLiveTotals);
                }
            });
            // Also listen for checkbox changes
            const recurringCheckbox = document.getElementById('initRecurringY1');
            if (recurringCheckbox) {
                recurringCheckbox.addEventListener('change', updateLiveTotals);
            }
        }

        function updateLiveTotals() {
            const editingId = document.getElementById('initId').value;

            // Get current modal values (both value and cost fields)
            const modalSavings = parseInt(document.getElementById('initSavings').value) || 0;
            const modalRevenue = parseInt(document.getElementById('initRevenue').value) || 0;
            const modalProductivity = parseInt(document.getElementById('initProductivity').value) || 0;
            const modalInvestment = parseInt(document.getElementById('initInvestment').value) || 0;
            const modalOngoing = parseInt(document.getElementById('initOngoing').value) || 0;

            // Calculate totals from all OTHER initiatives (excluding the one being edited)
            let otherSavings = 0;
            let otherRevenue = 0;
            let otherProductivity = 0;
            let otherInvestment = 0;
            let otherOngoing = 0;

            appData.initiatives.forEach(init => {
                if (init.id !== editingId) {
                    otherSavings += init.value.savings || 0;
                    otherRevenue += init.value.revenue || 0;
                    otherProductivity += init.value.productivity || 0;
                    otherInvestment += init.costs?.investment || 0;
                    otherOngoing += init.costs?.ongoing || 0;
                }
            });

            // Combined totals
            const totalSavings = otherSavings + modalSavings;
            const totalRevenue = otherRevenue + modalRevenue;
            const totalProductivity = otherProductivity + modalProductivity;
            const totalValue = totalSavings + totalRevenue + totalProductivity;
            const totalInvestment = otherInvestment + modalInvestment;
            const totalOngoing = otherOngoing + modalOngoing;
            const totalCosts = totalInvestment + totalOngoing;

            // Calculate dynamic ROI
            const netAnnualReturn = totalValue - totalOngoing;
            const roi = totalCosts > 0 ? Math.round((netAnnualReturn / totalCosts) * 100) : (totalValue > 0 ? 999 : 0);

            // Update all displays with same values - simple direct update
            document.getElementById('totalValue').textContent = totalValue.toLocaleString();
            document.getElementById('totalSavings').textContent = totalSavings.toLocaleString();
            document.getElementById('totalRevenue').textContent = totalRevenue.toLocaleString();
            document.getElementById('totalProductivity').textContent = totalProductivity.toLocaleString();
            document.getElementById('footerValue').textContent = totalValue.toLocaleString();
            document.getElementById('footerROI').textContent = roi >= 999 ? '' : roi;
        }

        // Initialize live updates when modal opens
        function showAddInitiativeModal() {
            document.getElementById('modalTitle').textContent = 'Add Initiative';
            document.getElementById('initiativeForm').reset();
            document.getElementById('initId').value = '';
            document.getElementById('initiativeModal').classList.remove('hidden');
            setupLiveValueUpdates();
        }

        function editInitiative(id) {
            const init = appData.initiatives.find(i => i.id === id);
            if (!init) return;

            document.getElementById('modalTitle').textContent = 'Edit Initiative';
            document.getElementById('initId').value = init.id;
            document.getElementById('initName').value = init.name;
            document.getElementById('initDescription').value = init.description;
            document.getElementById('initStatus').value = init.status;
            document.getElementById('initPriority').value = init.priority;
            document.getElementById('initStartDate').value = init.startDate;
            document.getElementById('initTargetDate').value = init.targetDate;
            document.getElementById('initSavings').value = init.value.savings;
            document.getElementById('initRevenue').value = init.value.revenue;
            document.getElementById('initProductivity').value = init.value.productivity;
            document.getElementById('initInvestment').value = init.costs.investment;
            document.getElementById('initOngoing').value = init.costs.ongoing;
            document.getElementById('initRecurringY1').checked = init.recurringStartsY1 || false;
            document.getElementById('initValueProps').value = (init.valueProps || []).join('\n');

            ['vp', 'exec', 'faculty', 'staff', 'students', 'board'].forEach(s => {
                document.getElementById(`impact-${s}`).checked = init.stakeholders?.includes(s) || false;
            });

            document.getElementById('initiativeModal').classList.remove('hidden');
            setupLiveValueUpdates();
        }

        // ================== CAPTAIN'S LOG ==================

        function renderRecentLog() {
            const container = document.getElementById('recentLog');
            const recent = [...appData.captainsLog].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)).slice(0, 5);

            container.innerHTML = recent.map(log => `
                <div class="border-l-4 log-${log.category} bg-gray-700/30 rounded-r-lg p-3">
                    <div class="flex justify-between text-xs text-gray-400 mb-1">
                        <span class="capitalize font-medium">${log.category}</span>
                        <span>${new Date(log.timestamp).toLocaleDateString()} ${new Date(log.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                    </div>
                    <p class="text-sm">${log.content}</p>
                </div>
            `).join('');
        }

        function renderLogList() {
            const container = document.getElementById('logList');
            const searchTerm = document.getElementById('logSearch')?.value.toLowerCase() || '';
            const categoryFilter = document.getElementById('logCategoryFilter')?.value || '';

            let filtered = [...appData.captainsLog].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            if (searchTerm) {
                filtered = filtered.filter(log => log.content.toLowerCase().includes(searchTerm));
            }
            if (categoryFilter) {
                filtered = filtered.filter(log => log.category === categoryFilter);
            }

            container.innerHTML = filtered.map(log => {
                const init = log.initiativeId ? appData.initiatives.find(i => i.id === log.initiativeId) : null;
                return `
                    <div class="border-l-4 log-${log.category} bg-gray-800 rounded-r-xl p-4">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex gap-2">
                                <span class="px-2 py-1 bg-gray-700 rounded text-xs capitalize">${log.category}</span>
                                ${init ? `<span class="px-2 py-1 rounded text-xs" style="background: ${init.color}20; color: ${init.color}">${init.name}</span>` : ''}
                            </div>
                            <span class="text-xs text-gray-400">${new Date(log.timestamp).toLocaleString()}</span>
                        </div>
                        <p class="text-gray-200">${log.content}</p>
                    </div>
                `;
            }).join('');
        }

        function filterLogs() {
            renderLogList();
        }

        function showAddLogModal() {
            document.getElementById('logContent').value = '';
            document.getElementById('logCategory').value = 'note';
            document.getElementById('logInitiative').value = '';
            document.getElementById('logModal').classList.remove('hidden');
        }

        function populateLogInitiativeDropdown() {
            const select = document.getElementById('logInitiative');
            if (!select) return;
            select.innerHTML = '<option value="">General (No specific initiative)</option>' +
                appData.initiatives.map(init => `<option value="${init.id}">${init.name}</option>`).join('');
        }

        function saveLogEntry(event) {
            event.preventDefault();

            const entry = {
                id: `log-${Date.now()}`,
                timestamp: new Date().toISOString(),
                category: document.getElementById('logCategory').value,
                initiativeId: document.getElementById('logInitiative').value || null,
                content: document.getElementById('logContent').value
            };

            appData.captainsLog.push(entry);
            saveData(appData);
            closeModal('logModal');
            renderView();
        }

        function addQuickLog() {
            const content = document.getElementById('quickLog').value.trim();
            if (!content) return;

            const entry = {
                id: `log-${Date.now()}`,
                timestamp: new Date().toISOString(),
                category: 'note',
                initiativeId: null,
                content
            };

            appData.captainsLog.push(entry);
            saveData(appData);
            document.getElementById('quickLog').value = '';
            renderView();
        }

        function exportLog() {
            const sorted = [...appData.captainsLog].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            let markdown = "# FLC Skunk Works - Captain's Log\n\n";
            markdown += `Exported: ${new Date().toLocaleString()}\n\n---\n\n`;

            sorted.forEach(log => {
                const init = log.initiativeId ? appData.initiatives.find(i => i.id === log.initiativeId) : null;
                markdown += `## ${new Date(log.timestamp).toLocaleString()}\n`;
                markdown += `**Category:** ${log.category}\n`;
                if (init) markdown += `**Initiative:** ${init.name}\n`;
                markdown += `\n${log.content}\n\n---\n\n`;
            });

            const blob = new Blob([markdown], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `captains-log-${new Date().toISOString().split('T')[0]}.md`;
            a.click();
        }

        // ================== CALENDAR ==================

        function initCalendar() {
            const calendarEl = document.getElementById('calendar');
            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,listWeek'
                },
                events: getCalendarEvents(),
                eventClick: function(info) {
                    const initId = info.event.extendedProps.initiativeId;
                    if (initId) editInitiative(initId);
                },
                height: 'auto'
            });
            calendar.render();
        }

        function getCalendarEvents() {
            const events = [];
            appData.initiatives.forEach(init => {
                if (init.startDate && init.targetDate) {
                    events.push({
                        title: init.name,
                        start: init.startDate,
                        end: init.targetDate,
                        color: init.color,
                        extendedProps: { initiativeId: init.id }
                    });
                }
                if (init.targetDate) {
                    events.push({
                        title: `${init.name} - Target`,
                        start: init.targetDate,
                        color: init.color,
                        extendedProps: { initiativeId: init.id }
                    });
                }
            });
            return events;
        }

        function updateCalendar() {
            if (calendar) {
                calendar.removeAllEvents();
                calendar.addEventSource(getCalendarEvents());
            }
        }

        // ================== STAKEHOLDER MATRIX ==================

        function renderStakeholderMatrix() {
            const tbody = document.getElementById('stakeholderMatrix');
            const stakeholderList = ['vp', 'exec', 'faculty', 'staff', 'students', 'board'];

            tbody.innerHTML = appData.initiatives.map(init => `
                <tr class="border-b border-gray-700">
                    <td class="p-3 font-medium">${init.name}</td>
                    ${stakeholderList.map(s => `
                        <td class="p-3 text-center">
                            ${init.stakeholders?.includes(s)
                                ? '<span class="inline-block w-6 h-6 bg-green-500 rounded-full"></span>'
                                : '<span class="inline-block w-6 h-6 bg-gray-600 rounded-full"></span>'}
                        </td>
                    `).join('')}
                </tr>
            `).join('');
        }

        // ================== 5-YEAR FINANCIAL PROJECTION (Executive Format) ==================

        function generateMultiYearROI() {
            const container = document.getElementById('multiYearTable');
            const badge = document.getElementById('roiSummaryBadge');

            // Aggregate all initiatives
            let totalInvestment = 0;
            let totalRecurring = 0;
            let totalRecurringY1 = 0; // Only if recurringStartsY1 is true
            let totalSavings = 0;
            let totalRevenue = 0;
            let totalProductivity = 0;

            appData.initiatives.forEach(init => {
                totalInvestment += init.costs?.investment || 0;
                const recurring = init.costs?.ongoing || 0;
                totalRecurring += recurring;
                if (init.recurringStartsY1) {
                    totalRecurringY1 += recurring;
                }
                totalSavings += init.value?.savings || 0;
                totalRevenue += init.value?.revenue || 0;
                totalProductivity += init.value?.productivity || 0;
            });

            const annualValue = totalSavings + totalRevenue + totalProductivity;

            // Calculate 5-year projection
            const years = [1, 2, 3, 4, 5];
            const data = years.map(year => {
                const investment = year === 1 ? totalInvestment : 0;
                const recurring = year === 1 ? totalRecurringY1 : totalRecurring;
                const costs = investment + recurring;
                const benefits = annualValue;
                const netCash = benefits - costs;
                return { year, investment, recurring, costs, benefits, netCash };
            });

            // Calculate cumulative values
            let cumCash = 0;
            data.forEach(d => {
                cumCash += d.netCash;
                d.cumCash = cumCash;
                d.cumROI = totalInvestment > 0 ? Math.round((cumCash / totalInvestment) * 100) : (cumCash > 0 ? 999 : 0);
            });

            // 5-Year totals
            const total5YrCosts = data.reduce((sum, d) => sum + d.costs, 0);
            const total5YrBenefits = data.reduce((sum, d) => sum + d.benefits, 0);
            const total5YrNet = data[4].cumCash;
            const total5YrROI = totalInvestment > 0 ? Math.round((total5YrNet / totalInvestment) * 100) : (total5YrNet > 0 ? 999 : 0);

            // Payback period (in months)
            let paybackMonths = 0;
            if (totalInvestment > 0 && annualValue > 0) {
                const monthlyBenefit = annualValue / 12;
                const monthlyRecurring = totalRecurring / 12;
                let remaining = totalInvestment + totalRecurringY1;
                for (let m = 1; m <= 60; m++) {
                    remaining -= (monthlyBenefit - (m > 12 ? monthlyRecurring : 0));
                    if (remaining <= 0) {
                        paybackMonths = m;
                        break;
                    }
                }
            }
            const paybackDisplay = paybackMonths > 0 ? (paybackMonths / 12).toFixed(1) + ' yrs' : 'Immediate';

            // Format helpers
            const fmt = (n) => n.toLocaleString();
            const fmtCost = (n) => n > 0 ? `($${fmt(n)})` : '';
            const fmtVal = (n) => n > 0 ? `$${fmt(n)}` : '';
            const fmtNet = (n) => n >= 0 ? `$${fmt(n)}` : `-$${fmt(Math.abs(n))}`;
            const fmtROI = (n, hasInvestment) => !hasInvestment ? '' : `${n.toLocaleString()}%`;
            const roiColor = (n) => n >= 100 ? 'text-green-400' : n >= 0 ? 'text-yellow-400' : 'text-red-400';
            const netColor = (n) => n >= 0 ? 'text-green-400' : 'text-red-400';
            const hasInvestment = totalInvestment > 0;

            // Update header badges
            badge.innerHTML = `
                <span class="px-3 py-1.5 rounded-lg text-sm font-bold bg-blue-500/20 text-blue-400">
                    Payback: ${paybackDisplay}
                </span>
                <span class="px-3 py-1.5 rounded-lg text-sm font-bold bg-flc-gold/20 text-flc-gold">
                    5-Yr Net: $${fmt(total5YrNet)}
                </span>
                <span class="px-3 py-1.5 rounded-lg text-sm font-bold ${total5YrROI >= 100 ? 'bg-green-500/20 text-green-400' : 'bg-yellow-500/20 text-yellow-400'}">
                    5-Yr ROI: ${fmtROI(total5YrROI, hasInvestment)}
                </span>
            `;

            // Build the executive-grade table
            container.innerHTML = `
            <table class="w-full text-sm">
                <thead>
                    <tr class="border-b-2 border-gray-600">
                        <th class="text-left py-3 px-4 font-semibold text-gray-300 w-44"></th>
                        ${years.map(y => `<th class="text-right py-3 px-4 font-semibold text-gray-400">Year ${y}</th>`).join('')}
                        <th class="text-right py-3 px-4 font-bold text-flc-gold">5-Year Total</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- COSTS SECTION -->
                    <tr class="bg-gray-800/50">
                        <td colspan="7" class="py-2 px-4 font-bold text-red-400 text-xs uppercase tracking-wide">Costs</td>
                    </tr>
                    <tr class="border-b border-gray-700/30">
                        <td class="py-2 px-4 text-gray-400 pl-6">Initial Investment</td>
                        ${years.map(y => `<td class="py-2 px-4 text-right text-red-400">${y === 1 ? fmtCost(totalInvestment) : ''}</td>`).join('')}
                        <td class="py-2 px-4 text-right text-red-400 font-semibold">${fmtCost(totalInvestment)}</td>
                    </tr>
                    <tr class="border-b border-gray-700/30">
                        <td class="py-2 px-4 text-gray-400 pl-6">Recurring Costs</td>
                        ${data.map(d => `<td class="py-2 px-4 text-right text-red-400">${fmtCost(d.recurring)}</td>`).join('')}
                        <td class="py-2 px-4 text-right text-red-400 font-semibold">${fmtCost(totalRecurringY1 + totalRecurring * 4)}</td>
                    </tr>
                    <tr class="border-b border-gray-600 bg-red-500/10">
                        <td class="py-2 px-4 font-semibold text-red-300 pl-6">Total Costs</td>
                        ${data.map(d => `<td class="py-2 px-4 text-right text-red-300 font-semibold">${fmtCost(d.costs)}</td>`).join('')}
                        <td class="py-2 px-4 text-right text-red-300 font-bold">${fmtCost(total5YrCosts)}</td>
                    </tr>

                    <!-- BENEFITS SECTION -->
                    <tr class="bg-gray-800/50">
                        <td colspan="7" class="py-2 px-4 font-bold text-green-400 text-xs uppercase tracking-wide">Benefits (Annual)</td>
                    </tr>
                    <tr class="border-b border-gray-700/30">
                        <td class="py-2 px-4 text-gray-400 pl-6">Cost Savings</td>
                        ${years.map(() => `<td class="py-2 px-4 text-right text-green-400">${fmtVal(totalSavings)}</td>`).join('')}
                        <td class="py-2 px-4 text-right text-green-400 font-semibold">${fmtVal(totalSavings * 5)}</td>
                    </tr>
                    <tr class="border-b border-gray-700/30">
                        <td class="py-2 px-4 text-gray-400 pl-6">Revenue Potential</td>
                        ${years.map(() => `<td class="py-2 px-4 text-right text-green-400">${fmtVal(totalRevenue)}</td>`).join('')}
                        <td class="py-2 px-4 text-right text-green-400 font-semibold">${fmtVal(totalRevenue * 5)}</td>
                    </tr>
                    <tr class="border-b border-gray-700/30">
                        <td class="py-2 px-4 text-gray-400 pl-6">Productivity Gains</td>
                        ${years.map(() => `<td class="py-2 px-4 text-right text-green-400">${fmtVal(totalProductivity)}</td>`).join('')}
                        <td class="py-2 px-4 text-right text-green-400 font-semibold">${fmtVal(totalProductivity * 5)}</td>
                    </tr>
                    <tr class="border-b border-gray-600 bg-green-500/10">
                        <td class="py-2 px-4 font-semibold text-green-300 pl-6">Total Annual Value</td>
                        ${years.map(() => `<td class="py-2 px-4 text-right text-green-300 font-semibold">${fmtVal(annualValue)}</td>`).join('')}
                        <td class="py-2 px-4 text-right text-green-300 font-bold">${fmtVal(total5YrBenefits)}</td>
                    </tr>

                    <!-- RETURNS SECTION -->
                    <tr class="bg-gray-800/50">
                        <td colspan="7" class="py-2 px-4 font-bold text-flc-gold text-xs uppercase tracking-wide">Returns</td>
                    </tr>
                    <tr class="border-b border-gray-700/30">
                        <td class="py-2 px-4 text-gray-300 pl-6">Annual Net Cash</td>
                        ${data.map(d => `<td class="py-2 px-4 text-right font-semibold ${netColor(d.netCash)}">${fmtNet(d.netCash)}</td>`).join('')}
                        <td class="py-2 px-4 text-right font-bold ${netColor(total5YrNet)}">${fmtNet(total5YrNet)}</td>
                    </tr>
                    <tr class="border-b border-gray-700/30 bg-flc-gold/5">
                        <td class="py-2 px-4 text-white font-semibold pl-6">Cumulative Cash</td>
                        ${data.map(d => `<td class="py-2 px-4 text-right font-bold ${netColor(d.cumCash)}">${fmtNet(d.cumCash)}</td>`).join('')}
                        <td class="py-2 px-4 text-right text-gray-500"></td>
                    </tr>
                    <tr class="bg-gradient-to-r from-flc-gold/20 to-flc-gold/5">
                        <td class="py-3 px-4 text-white font-bold pl-6">Cumulative ROI</td>
                        ${data.map(d => `<td class="py-3 px-4 text-right font-bold text-lg ${roiColor(d.cumROI)}">${fmtROI(d.cumROI, hasInvestment)}</td>`).join('')}
                        <td class="py-3 px-4 text-right font-bold text-xl text-flc-gold">${fmtROI(total5YrROI, hasInvestment)}</td>
                    </tr>
                </tbody>
            </table>

            <!-- Executive Summary Box -->
            <div class="mt-4 p-4 bg-gradient-to-r from-flc-blue/20 to-gray-800/50 rounded-lg border border-flc-gold/30">
                <p class="text-sm text-gray-300">
                    <span class="text-flc-gold font-bold">Executive Summary:</span>
                    ${hasInvestment
                        ? `A <span class="text-white font-semibold">$${fmt(totalInvestment)}</span> investment generates <span class="text-green-400 font-semibold">$${fmt(total5YrNet)}</span> in net returns over 5 years  a <span class="text-flc-gold font-bold">${fmtROI(total5YrROI, true)} return</span> with payback in <span class="text-blue-400 font-semibold">${paybackDisplay}</span>.`
                        : `Program delivers <span class="text-green-400 font-semibold">$${fmt(annualValue)}/year</span> in value (<span class="text-flc-gold font-semibold">$${fmt(total5YrBenefits)}</span> over 5 years). Add investment costs to calculate ROI.`
                    }
                </p>
            </div>
            `;
        }

        // ================== EXECUTIVE SUMMARY ==================

        function generateExecutiveSummary() {
            const container = document.getElementById('executiveSummary');
            const totals = calculateTotals();
            const activeInits = appData.initiatives.filter(i => i.status === 'active' || i.status === 'planning');
            const wins = appData.captainsLog.filter(l => l.category === 'win').slice(-3);

            let summary = `<p><strong>Program Status:</strong> ${activeInits.length} active initiatives delivering $${totals.totalValue.toLocaleString()} in projected annual value.</p>`;

            summary += `<p class="mt-2"><strong>Active Initiatives:</strong></p><ul class="list-disc list-inside text-gray-400">`;
            activeInits.forEach(init => {
                const initValue = (init.value.savings + init.value.revenue + init.value.productivity).toLocaleString();
                summary += `<li><strong>${init.name}</strong> - $${initValue}/yr`;
                if (init.valueProps && init.valueProps.length > 0) {
                    summary += `<ul class="list-disc list-inside ml-4 text-gray-500 text-xs mt-1 mb-2">`;
                    init.valueProps.forEach(prop => {
                        summary += `<li>${prop}</li>`;
                    });
                    summary += `</ul>`;
                }
                summary += `</li>`;
            });
            summary += `</ul>`;

            if (wins.length > 0) {
                summary += `<p class="mt-2"><strong>Recent Wins:</strong></p><ul class="list-disc list-inside text-gray-400">`;
                wins.forEach(w => summary += `<li>${w.content}</li>`);
                summary += `</ul>`;
            }

            // Show investment and dynamic ROI
            if (totals.totalCosts > 0) {
                summary += `<p class="mt-2"><strong>Investment:</strong> $${totals.totalInvestment.toLocaleString()} one-time + $${totals.totalOngoing.toLocaleString()}/yr ongoing</p>`;
                summary += `<p><strong>Annual ROI:</strong> <span class="${totals.roi >= 100 ? 'text-green-400' : totals.roi >= 50 ? 'text-yellow-400' : 'text-red-400'}">${totals.roi}%</span> return on investment</p>`;
            } else {
                summary += `<p class="mt-2 text-amber-400/80 italic"><strong>Note:</strong> Add investment costs to initiatives to calculate ROI</p>`;
            }

            container.innerHTML = summary;
        }

        function copyExecutiveSummary() {
            const totals = calculateTotals();
            const activeInits = appData.initiatives.filter(i => i.status === 'active' || i.status === 'planning');

            let text = `FLC Skunk Works Status Update\n\n`;
            text += `Total Projected Value: $${totals.totalValue.toLocaleString()}/year\n`;
            text += `Active Initiatives: ${activeInits.length}\n\n`;
            text += `Initiatives:\n`;
            activeInits.forEach(init => {
                text += `- ${init.name}: $${(init.value.savings + init.value.revenue + init.value.productivity).toLocaleString()}\n`;
            });

            navigator.clipboard.writeText(text).then(() => {
                alert('Executive summary copied to clipboard!');
            });
        }

        // ================== PDF EXPORT ==================

        function exportToPDF() {
            const totals = calculateTotals();
            const activeInits = appData.initiatives.filter(i => i.status === 'active' || i.status === 'planning');
            const recentWins = appData.captainsLog.filter(l => l.category === 'win').slice(-3);
            const recentLogs = [...appData.captainsLog].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)).slice(0, 5);

            // Create print-optimized content
            const printContent = document.createElement('div');
            printContent.id = 'pdf-export';
            printContent.innerHTML = `
                <div style="font-family: 'Inter', Arial, sans-serif; padding: 40px; background: white; color: #1a1a2e; max-width: 1000px; margin: 0 auto;">
                    <!-- Header -->
                    <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid #C4A000; padding-bottom: 20px; margin-bottom: 30px;">
                        <div>
                            <h1 style="font-size: 28px; font-weight: 800; color: #003366; margin: 0;">FLC Skunk Works</h1>
                            <p style="font-size: 14px; color: #666; margin: 5px 0 0 0;">Institutional Research Innovation Lab</p>
                        </div>
                        <div style="text-align: right;">
                            <p style="font-size: 12px; color: #666; margin: 0;">Executive Summary Report</p>
                            <p style="font-size: 12px; color: #666; margin: 0;">${new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
                        </div>
                    </div>

                    <!-- Key Metrics - Big Numbers -->
                    <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; margin-bottom: 30px;">
                        <div style="background: linear-gradient(135deg, #003366 0%, #004080 100%); color: white; padding: 15px; border-radius: 12px; text-align: center;">
                            <p style="font-size: 28px; font-weight: 800; margin: 0;">$${totals.totalValue.toLocaleString()}</p>
                            <p style="font-size: 11px; opacity: 0.8; margin: 5px 0 0 0;">Total Value/Year</p>
                        </div>
                        <div style="background: linear-gradient(135deg, #059669 0%, #10b981 100%); color: white; padding: 15px; border-radius: 12px; text-align: center;">
                            <p style="font-size: 28px; font-weight: 800; margin: 0;">$${totals.totalSavings.toLocaleString()}</p>
                            <p style="font-size: 11px; opacity: 0.8; margin: 5px 0 0 0;">Cost Savings</p>
                        </div>
                        <div style="background: linear-gradient(135deg, #C4A000 0%, #eab308 100%); color: #1a1a2e; padding: 15px; border-radius: 12px; text-align: center;">
                            <p style="font-size: 28px; font-weight: 800; margin: 0;">$${totals.totalRevenue.toLocaleString()}</p>
                            <p style="font-size: 11px; opacity: 0.7; margin: 5px 0 0 0;">Revenue Potential</p>
                        </div>
                        <div style="background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%); color: white; padding: 15px; border-radius: 12px; text-align: center;">
                            <p style="font-size: 28px; font-weight: 800; margin: 0;">$${totals.totalProductivity.toLocaleString()}</p>
                            <p style="font-size: 11px; opacity: 0.8; margin: 5px 0 0 0;">Productivity Savings</p>
                        </div>
                        <div style="background: linear-gradient(135deg, #7c3aed 0%, #8b5cf6 100%); color: white; padding: 15px; border-radius: 12px; text-align: center;">
                            <p style="font-size: 28px; font-weight: 800; margin: 0;">${totals.roi}%</p>
                            <p style="font-size: 11px; opacity: 0.8; margin: 5px 0 0 0;">Projected ROI</p>
                        </div>
                    </div>

                    <!-- Initiatives Table -->
                    <div style="margin-bottom: 30px;">
                        <h2 style="font-size: 18px; font-weight: 700; color: #003366; margin: 0 0 15px 0; padding-bottom: 8px; border-bottom: 2px solid #e5e7eb;">Active Initiatives (${activeInits.length})</h2>
                        <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                            <thead>
                                <tr style="background: #f3f4f6;">
                                    <th style="text-align: left; padding: 12px; border-bottom: 2px solid #e5e7eb; font-weight: 600;">Initiative</th>
                                    <th style="text-align: center; padding: 12px; border-bottom: 2px solid #e5e7eb; font-weight: 600;">Status</th>
                                    <th style="text-align: right; padding: 12px; border-bottom: 2px solid #e5e7eb; font-weight: 600;">Savings</th>
                                    <th style="text-align: right; padding: 12px; border-bottom: 2px solid #e5e7eb; font-weight: 600;">Revenue</th>
                                    <th style="text-align: right; padding: 12px; border-bottom: 2px solid #e5e7eb; font-weight: 600;">Total Value</th>
                                    <th style="text-align: center; padding: 12px; border-bottom: 2px solid #e5e7eb; font-weight: 600;">Target</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${appData.initiatives.map(init => `
                                    <tr style="border-bottom: 1px solid #e5e7eb;">
                                        <td style="padding: 12px; font-weight: 500;">${init.name}</td>
                                        <td style="padding: 12px; text-align: center;">
                                            <span style="padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 600; text-transform: uppercase;
                                                ${init.status === 'active' ? 'background: #dcfce7; color: #166534;' : ''}
                                                ${init.status === 'planning' ? 'background: #fef3c7; color: #92400e;' : ''}
                                                ${init.status === 'complete' ? 'background: #dbeafe; color: #1e40af;' : ''}
                                                ${init.status === 'blocked' ? 'background: #fee2e2; color: #991b1b;' : ''}
                                            ">${init.status}</span>
                                        </td>
                                        <td style="padding: 12px; text-align: right; color: #059669; font-weight: 600;">$${init.value.savings.toLocaleString()}</td>
                                        <td style="padding: 12px; text-align: right; color: #C4A000; font-weight: 600;">$${init.value.revenue.toLocaleString()}</td>
                                        <td style="padding: 12px; text-align: right; font-weight: 700;">$${(init.value.savings + init.value.revenue + init.value.productivity).toLocaleString()}</td>
                                        <td style="padding: 12px; text-align: center; color: #666;">${init.targetDate || 'TBD'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                            <tfoot>
                                <tr style="background: #f9fafb; font-weight: 700;">
                                    <td style="padding: 12px;" colspan="2">TOTAL</td>
                                    <td style="padding: 12px; text-align: right; color: #059669;">$${totals.totalSavings.toLocaleString()}</td>
                                    <td style="padding: 12px; text-align: right; color: #C4A000;">$${totals.totalRevenue.toLocaleString()}</td>
                                    <td style="padding: 12px; text-align: right; color: #003366;">$${totals.totalValue.toLocaleString()}</td>
                                    <td style="padding: 12px;"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>

                    <!-- Two Column: Recent Activity & Stakeholder Impact -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                        <!-- Recent Activity -->
                        <div>
                            <h2 style="font-size: 16px; font-weight: 700; color: #003366; margin: 0 0 12px 0; padding-bottom: 8px; border-bottom: 2px solid #e5e7eb;">Recent Activity</h2>
                            <div style="font-size: 12px;">
                                ${recentLogs.map(log => `
                                    <div style="padding: 8px 0; border-bottom: 1px solid #f3f4f6;">
                                        <span style="display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: 600; text-transform: uppercase; margin-right: 8px;
                                            ${log.category === 'win' ? 'background: #fef3c7; color: #92400e;' : ''}
                                            ${log.category === 'progress' ? 'background: #dcfce7; color: #166534;' : ''}
                                            ${log.category === 'decision' ? 'background: #ede9fe; color: #5b21b6;' : ''}
                                            ${log.category === 'blocker' ? 'background: #fee2e2; color: #991b1b;' : ''}
                                            ${log.category === 'note' ? 'background: #f3f4f6; color: #4b5563;' : ''}
                                        ">${log.category}</span>
                                        <span style="color: #666;">${log.content.substring(0, 60)}${log.content.length > 60 ? '...' : ''}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <!-- Stakeholder Impact -->
                        <div>
                            <h2 style="font-size: 16px; font-weight: 700; color: #003366; margin: 0 0 12px 0; padding-bottom: 8px; border-bottom: 2px solid #e5e7eb;">Stakeholder Impact</h2>
                            <table style="width: 100%; font-size: 11px; border-collapse: collapse;">
                                <thead>
                                    <tr>
                                        <th style="text-align: left; padding: 6px; border-bottom: 1px solid #e5e7eb;">Initiative</th>
                                        <th style="text-align: center; padding: 6px; border-bottom: 1px solid #e5e7eb;">VP</th>
                                        <th style="text-align: center; padding: 6px; border-bottom: 1px solid #e5e7eb;">Exec</th>
                                        <th style="text-align: center; padding: 6px; border-bottom: 1px solid #e5e7eb;">Faculty</th>
                                        <th style="text-align: center; padding: 6px; border-bottom: 1px solid #e5e7eb;">Staff</th>
                                        <th style="text-align: center; padding: 6px; border-bottom: 1px solid #e5e7eb;">Students</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${appData.initiatives.map(init => `
                                        <tr>
                                            <td style="padding: 6px; font-size: 10px;">${init.name.split('(')[0].trim()}</td>
                                            ${['vp', 'exec', 'faculty', 'staff', 'students'].map(s => `
                                                <td style="text-align: center; padding: 6px;">
                                                    ${init.stakeholders?.includes(s) ? '<span style="color: #059669; font-weight: bold;"></span>' : '<span style="color: #d1d5db;">-</span>'}
                                                </td>
                                            `).join('')}
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Footer -->
                    <div style="margin-top: 30px; padding-top: 15px; border-top: 2px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;">
                        <div style="font-size: 11px; color: #666;">
                            <strong>Fort Lewis College</strong> | Institutional Research Innovation Lab
                        </div>
                        <div style="font-size: 11px; color: #666;">
                            Generated by Skunk Works Command Center
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(printContent);

            const opt = {
                margin: [0.3, 0.3, 0.3, 0.3],
                filename: `FLC-SkunkWorks-Report-${new Date().toISOString().split('T')[0]}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: {
                    scale: 2,
                    useCORS: true,
                    backgroundColor: '#ffffff'
                },
                jsPDF: {
                    unit: 'in',
                    format: 'letter',
                    orientation: 'landscape'
                },
                pagebreak: { mode: 'avoid-all' }
            };

            html2pdf().set(opt).from(printContent).save().then(() => {
                document.body.removeChild(printContent);
            });
        }

        // ================== MODALS ==================

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function showDeleteModal(initId) {
            const init = appData.initiatives.find(i => i.id === initId);
            if (!init) return;

            document.getElementById('deleteInitId').value = initId;
            document.getElementById('deleteInitName').textContent = init.name;
            document.getElementById('deleteModal').classList.remove('hidden');
        }

        function confirmDelete() {
            const initId = document.getElementById('deleteInitId').value;
            const initIndex = appData.initiatives.findIndex(i => i.id === initId);

            if (initIndex === -1) {
                closeModal('deleteModal');
                return;
            }

            // Archive the initiative (soft delete)
            const deletedInit = appData.initiatives[initIndex];
            deletedInit.deletedAt = new Date().toISOString();

            if (!appData.archived) {
                appData.archived = [];
            }
            appData.archived.push(deletedInit);

            // Remove from active initiatives
            appData.initiatives.splice(initIndex, 1);

            saveData(appData);
            closeModal('deleteModal');
            renderView();
        }

        // ================== SCENARIO MANAGEMENT ==================

        function setScenario(scenarioKey) {
            currentScenario = scenarioKey;
            const scenarioValues = SCENARIO_VALUES[scenarioKey];

            // Apply scenario values to each initiative
            appData.initiatives.forEach(init => {
                if (scenarioValues[init.id]) {
                    const sv = scenarioValues[init.id];
                    init.value.savings = sv.savings;
                    init.value.revenue = sv.revenue;
                    init.value.productivity = sv.productivity;
                }
            });

            // Update UI
            updateScenarioToggleUI();
            saveData(appData);
            renderView();

            // Update URL
            updateURLWithScenario();
        }

        function updateScenarioToggleUI() {
            const buttons = ['conservative', 'moderate', 'optimistic'];
            buttons.forEach(key => {
                const btn = document.getElementById(`btn-${key}`);
                if (btn) {
                    btn.classList.remove('active-conservative', 'active-moderate', 'active-optimistic', 'text-gray-400');
                    if (key === currentScenario) {
                        btn.classList.add(`active-${key}`);
                    } else {
                        btn.classList.add('text-gray-400');
                    }
                }
            });

            // Update description
            const desc = document.getElementById('scenarioDescription');
            if (desc) {
                desc.textContent = SCENARIO_DESCRIPTIONS[currentScenario] || '';
            }
        }

        function updateURLWithScenario() {
            const url = new URL(window.location.href);
            url.searchParams.set('scenario', currentScenario);
            window.history.replaceState({}, '', url.toString());
        }

        function loadScenarioFromURL() {
            const url = new URL(window.location.href);
            const scenario = url.searchParams.get('scenario');
            if (scenario && SCENARIO_VALUES[scenario]) {
                setScenario(scenario);
            } else {
                updateScenarioToggleUI();
            }
        }

        function copyScenarioLink() {
            updateURLWithScenario();
            navigator.clipboard.writeText(window.location.href).then(() => {
                showToast('Link copied! Share to show the same scenario.');
            }).catch(err => {
                console.error('Failed to copy:', err);
                showToast('Failed to copy link', 'error');
            });
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `fixed bottom-20 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-lg text-sm font-medium z-50 transition-all duration-300 ${type === 'success' ? 'bg-green-600 text-white' : 'bg-red-600 text-white'}`;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ================== MOBILE DETECTION & SIDEBAR MANAGEMENT ==================

        let sidebarOpen = false;

        // Detect mobile using touch capability and screen size
        function isMobileDevice() {
            // Check for touch capability
            const hasTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
            // Check actual screen width (not viewport which is affected by initial-scale)
            const smallScreen = window.screen.width < 1024;
            return hasTouch && smallScreen;
        }

        // Apply mobile class to body
        function applyMobileClass() {
            if (isMobileDevice()) {
                document.body.classList.add('is-mobile');
            } else {
                document.body.classList.remove('is-mobile');
            }
        }

        function toggleSidebar() {
            sidebarOpen = !sidebarOpen;
            updateSidebarState();
        }

        function openSidebar() {
            sidebarOpen = true;
            updateSidebarState();
        }

        function closeSidebar() {
            sidebarOpen = false;
            updateSidebarState();
        }

        function updateSidebarState() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            const hamburgerIcon = document.getElementById('hamburgerIcon');
            const closeIcon = document.getElementById('closeIcon');

            if (sidebarOpen) {
                sidebar.classList.add('open');
                overlay.classList.add('active');
                hamburgerIcon.classList.add('hidden');
                closeIcon.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            } else {
                sidebar.classList.remove('open');
                overlay.classList.remove('active');
                hamburgerIcon.classList.remove('hidden');
                closeIcon.classList.add('hidden');
                document.body.style.overflow = '';
            }
        }

        // Recheck mobile status on resize
        window.addEventListener('resize', function() {
            applyMobileClass();
            const isMobile = isMobileDevice();

            // Close sidebar if we switched to desktop
            if (!isMobile && sidebarOpen) {
                closeSidebar();
            }

            // Toggle mobile nav links visibility
            const mobileNavLinks = document.getElementById('mobileNavLinks');
            if (mobileNavLinks) mobileNavLinks.style.display = isMobile ? 'block' : 'none';

            // Toggle desktop nav buttons visibility
            const desktopNavBtns = document.getElementById('desktopNavBtns');
            if (desktopNavBtns) desktopNavBtns.style.display = isMobile ? 'none' : 'flex';

            // Toggle right hamburger visibility
            const navHamburgerBtn = document.getElementById('navHamburgerBtn');
            if (navHamburgerBtn) navHamburgerBtn.style.display = 'none'; // Always hidden now
        });

        // ================== KEYBOARD SHORTCUTS ==================

        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') return;

            switch(e.key.toLowerCase()) {
                case 'd': showView('dashboard'); break;
                case 'i': showView('initiatives'); break;
                case 'c': showView('calendar'); break;
                case 'l': showView('log'); break;
                case 'n': showAddLogModal(); break;
                case 'escape':
                    closeModal('initiativeModal');
                    closeModal('logModal');
                    closeModal('deleteModal');
                    if (sidebarOpen) closeSidebar();
                    break;
            }
        });

        // ================== INITIALIZE ==================

        document.addEventListener('DOMContentLoaded', () => {
            // Detect mobile and apply class FIRST
            applyMobileClass();

            loadScenarioFromURL();
            showView('dashboard');

            // Mobile-specific setup
            if (isMobileDevice()) {
                // Ensure sidebar starts closed on mobile
                closeSidebar();

                // Show mobile nav links in sidebar
                const mobileNavLinks = document.getElementById('mobileNavLinks');
                if (mobileNavLinks) mobileNavLinks.style.display = 'block';

                // Hide desktop nav buttons on mobile (CSS isn't working due to viewport scale)
                const desktopNavBtns = document.getElementById('desktopNavBtns');
                if (desktopNavBtns) desktopNavBtns.style.display = 'none';

                // Hide the broken right hamburger
                const navHamburgerBtn = document.getElementById('navHamburgerBtn');
                if (navHamburgerBtn) navHamburgerBtn.style.display = 'none';
            }
        });
    </script>
</body>
</html>
